from pathlib import Path
import shutil


def organize_clinical_files(folder_path: str) -> None:
    """
    Rearranges the contents of *folder_path* into a structured hierarchy:

    ğŸ“‚ md/
        â”œâ”€ ğŸ“‚ codex_output/     â€¦ all *.md* files whose names contain *codex_output*
        â””â”€ ğŸ“‚ smart_ocr/        â€¦ all remaining *.md* files
    ğŸ“‚ xml/                     â€¦ all *.xml* files
    ğŸ“‚ pdf/                     â€¦ all *.pdf* files

    Parameters
    ----------
    folder_path : str | Path
        Path to the directory that currently holds the mixed set of files.

    Notes
    -----
    â€¢ Existing destination folders are reused if they already exist.  
    â€¢ If a file with the same name is already present in the destination,
      it will be overwritten.
    """

    base_dir = Path(folder_path).expanduser().resolve()

    # --- create the destination tree ------------------------------------------------
    md_codex_dir  = base_dir / "md"  / "codex_output"
    md_ocr_dir    = base_dir / "md"  / "smart_ocr"
    xml_dir       = base_dir / "xml"
    pdf_dir       = base_dir / "pdf"

    for d in (md_codex_dir, md_ocr_dir, xml_dir, pdf_dir):
        d.mkdir(parents=True, exist_ok=True)

    # --- move files into their buckets ----------------------------------------------
    for file_path in base_dir.iterdir():
        if file_path.is_dir():
            continue  # skip folders that may already exist

        suffix = file_path.suffix.lower()
        name_lower = file_path.name.lower()

        try:
            if suffix == ".md":
                target_dir = md_codex_dir if "codex_output" in name_lower else md_ocr_dir
            elif suffix == ".xml":
                target_dir = xml_dir
            elif suffix == ".pdf":
                target_dir = pdf_dir
            else:
                continue  # ignore any other file types

            shutil.move(str(file_path), target_dir / file_path.name)

        except Exception as exc:
            print(f"âš ï¸  Could not move {file_path.name}: {exc}")


# -------------------------------------------------------------------------------
# Example usage
# -------------------------------------------------------------------------------
if __name__ == "__main__":
    organize_clinical_files(r"C:\path\to\your\mixed_folder")
