import requests
import json

# Load your JSON input file
with open("your_input.json") as f:
    data = json.load(f)

# Base API endpoint template
BASE_URL = "https://ingestion.synthesisuat.awsdns.internal.das/api/storage/download?filePath={}&isDecrypt=true"

# Combine all chunk contents
combined_xml = ""

# Iterate through each chunk
for chunk in data.get("chunks", []):
    chunk_path = chunk.get("chunk_url")
    if not chunk_path:
        continue

    full_url = BASE_URL.format(chunk_path)

    try:
        response = requests.get(full_url, verify=False, timeout=15)
        if response.status_code == 200:
            combined_xml += response.text.strip() + "\n"
        else:
            print(f"Failed to download: {full_url} - Status {response.status_code}")
    except Exception as e:
        print(f"Error while fetching {full_url}: {str(e)}")

# Save or print combined result
with open("combined_output.xml", "w", encoding="utf-8") as f:
    f.write(combined_xml)

print("Download and merge completed.")
