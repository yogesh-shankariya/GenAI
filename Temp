async def generate_combined_xml(trace_id: str, req: ReferralRequest) -> str:
    logger = logging.getLogger(__name__)
    logger.info(f"{trace_id} - Starting referral processing")

    combined_xml = ""
    for chunk in req.chunks:
        if chunk.loincd != "42349-1":
            logger.info(f"{trace_id} - Skipping chunk with loincd: {chunk.loincd}")
            continue  # Skip if loincd is not "42349-1"

        full_url = BASE_URL.format(chunk.chunk_url)
        try:
            response = requests.get(full_url, verify=False, timeout=15)
            if response.status_code == 200:
                combined_xml += response.text.strip() + "\n"
                logger.info(f"{trace_id} - Successfully fetched: {chunk.chunk_url}")
            else:
                logger.warning(f"{trace_id} - Failed: {chunk.chunk_url}, Status: {response.status_code}")
        except Exception as e:
            logger.error(f"{trace_id} - Exception fetching {chunk.chunk_url}: {str(e)}")

    return combined_xml
