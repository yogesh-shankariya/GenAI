import os
import requests

def process_files_from_api_sequential(base_path, search_texts, start_seq=1):
    all_results = {}
    seq_num = start_seq

    chart_path = os.path.dirname(base_path)
    folder_name = os.path.basename(chart_path)

    while True:
        url = f"https://document.synthesisuat.awsdns.internal.das/api/document/download?filePath={chart_path}/{folder_name}docXtrOutput-encounter-{seq_num}.txt"

        try:
            response = requests.get(url, verify=False, stream=True)
            response.raise_for_status()

            # Save to file (adjust extension based on content-type if needed)
            file_name = f"downloaded_file_{seq_num}.pdf"
            with open(file_name, 'wb') as f:
                for chunk in response.iter_content(chunk_size=8192):
                    f.write(chunk)

            print(f"Saved file: {file_name}")

            seq_num += 1

        except requests.exceptions.HTTPError as e:
            if e.response.status_code == 404:
                print(f"File not found at {url}. Stopping.")
                break
            else:
                raise
